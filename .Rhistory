library(packrat)
install.packages("packrat")
library(packrat)
packrat::on(project = '/home/dflouriot/Documents/R/Shiny_Cyclisme/',auto.snapshot = T )
getwd()
# packrat::set_opts(symlink.system.packages = F)
# packrat::set_opts(local.repos = '/Library/Frameworks/R.framework/Versions/3.5/Resources/library/')
setwd('/home/dflouriot/Documents/R/Shiny_Cyclisme/')
packrat::on(project = '/home/dflouriot/Documents/R/Shiny_Cyclisme/',auto.snapshot = T )
packrat::on()
#Vérifier si tous les packages ont été chargés
packrat::status()
.libPaths()
#Vérifier si tous les packages ont été chargés
packrat::status()
install.packages("devtools")
library(devtools)
packrat::on()
# packrat::set_opts(symlink.system.packages = F)
# packrat::set_opts(local.repos = '/Library/Frameworks/R.framework/Versions/3.5/Resources/library/')
setwd('/home/dflouriot/Documents/R/Shiny_Cyclisme')
packrat::on()
packrat::on(project = '/home/dflouriot/Documents/R/Shiny_Cyclisme')
packrat::set_opts(external.packages = c("devtools", "knitr"))
packrat::set_opts(external.packages = c("devtools"))
packrat::on(project = '/home/dflouriot/Documents/R/Shiny_Cyclisme')
#Vérifier si tous les packages ont été chargés
packrat::status()
packrat::snapshot()
packrat::restore()
packrat::status()
shiny::runApp()
load(file = "/Home/Documents/R/Cyclisme/Scrapping/Data/final_riders.RData")
load(file = "/Home/Documents/R/Scrapping/Cyclisme/Scrapping/Data/final_riders.RData")
runApp()
load(file = '/home/dflouriot/Documents/R/Scrapping/Cyclisme/Scrapping/Data/final_riders.RData')
runApp()
packrat::off()
packrat::on(project = '/home/dflouriot/Documents/R/Shiny_Cyclisme')
#packrat::opts$ignored.packages(c(""))
#remove.packages("xtable")
install.packages("devtools")
packrat::set_opts(external.packages = c("devtools"))
packrat::on(project = '/home/dflouriot/Documents/R/Shiny_Cyclisme')
#packrat::opts$ignored.packages(c(""))
#remove.packages("xtable")
install.packages("devtools")
packrat::off()
packrat::on(project = '/home/dflouriot/Documents/R/Shiny_Cyclisme')
packrat::status()
library(rmarkdown)
runApp()
runApp()
runApp()
packrat::off
packrat::of
packrat::off
packrat::off()
runApp()
runApp()
runApp()
#setwd("/home/ldapusers/dflouriot/Shiny/TDB_RubX/")
#getwd()
packrat::on()
runApp()
packrat::off()
runApp()
#packrat::set_opts(external.packages = c("devtools"))
install.packages("devtools",lib='/usr/local/lib/R/site-library/')
runApp()
packrat::status()
#packrat::opts$ignored.packages(c(""))
#remove.packages("xtable")
packrat::clean(packages = 'devtools')
packrat::off()
packrat::on(project = '/home/dflouriot/Documents/R/Shiny_Cyclisme')
#packrat::opts$ignored.packages(c(""))
#remove.packages("xtable")
packrat::clean(packages = 'devtools')
#packrat::opts$ignored.packages(c(""))
#remove.packages("xtable")
packrat::clean(packages = 'devtools',force = TRUE)
packrat::snapshot()
runApp()
#setwd("/home/ldapusers/dflouriot/Shiny/TDB_RubX/")
#getwd()
packrat::set_opts(external.packages = c("devtools"))
packrat::on()
runApp()
runApp()
packrat::off()
runApp()
unlink("home/dflouriot/Documents/R/Shiny_Cyclisme/packrat/lib-R", recursive = TRUE)
runApp()
packrat::off
packrat::off()
runApp()
runApp()
packrat::on()
#setwd("/home/ldapusers/dflouriot/Shiny/TDB_RubX/")
#getwd()
#packrat::set_opts(external.packages = c("devtools"))
#packrat::on()
library(devtools)
.libPaths()
runApp()
shiny::runApp()
runApp()
packrat::status()
#packrat::opts$ignored.packages(c(""))
#remove.packages("xtable")
packrat::clean(
)
packrat::snapshot()
packrat::restore()
packrat::status()
packrat::snapshot()
packrat::restore()
runApp()
#setwd("/home/ldapusers/dflouriot/Shiny/TDB_RubX/")
#getwd()
#packrat::set_opts(external.packages = c("devtools"))
packrat::on()
#library(rmarkdown)
library(shiny)
library(shinyBS)
library(shinyjs)
library(shinydashboard)
library(shinythemes)
library(formattable)
library(dplyr)
library(DT)
library(datasets)
library(shinythemes)
#library(withr)
library(ggplot2)
runApp()
#setwd("/home/ldapusers/dflouriot/Shiny/TDB_RubX/")
#getwd()
#packrat::set_opts(external.packages = c("devtools"))
unlink("./packrat/lib-R", recursive = TRUE)
getwd()
shiny::runApp()
packrat::clean()
packrat::clean(packages = 'devtools')
packrat::clean(packages = 'devtools',force = TRUE)
install.packages("devtools")
shiny::runApp()
packrat::clean(packages = 'devtools',force = TRUE)
packrat::status()
packrat::snapshot()
packrat::on()
install.packages("devtools")
packrat::snapshot()
packrat::restore()
getwd()
lib="/home/dflouriot/Documents/R/Scrapping/Cyclisme/packrat/lib/x86_64-apple-darwin15.6.0/3.5.1/"
library(Rcrawler,lib.loc = lib)
lib="/home/dflouriot/Documents/R/Scrapping/Cyclisme/packrat/lib/x86_64-apple-darwin15.6.0/3.5.1/
library(Rcrawler,lib.loc = lib)
library(xml2,lib.loc = lib)
library(httr,lib.loc = lib)
library(XML,lib.loc = lib)
library(data.table,lib.loc = lib)
library(iterators,lib.loc = lib)
library(foreach,lib.loc = lib)
library(doParallel,lib.loc = lib)
library(curl,lib.loc = lib)
library(rvest,lib.loc = lib)
library(stringr,lib.loc = lib)
library(RCurl,lib.loc = lib)
library(dplyr,lib.loc = lib)
date_jour=unlist(strsplit(date(), " "))
date_jour=paste0(date_jour[3],"_",date_jour[2],"_",date_jour[5])
num_riders=matrix(nrow = 1000, ncol = 2)
deb_=1
fin_=20
#1536
for (j in 1:50) {
tryCatch({
url <- paste0("http://www.cyclingsimulator.com/ajax_riderlist.php?page=Hire&pagenumber=",j,"&order=Date&sending=desc&nation=All")
# http://www.cyclingsimulator.com/?page=Riders&pagenumber=2000&order=Rider&sending=asc&nation=All&showLowRS=1
# http://www.cyclingsimulator.com/ajax_riderlist.php?page=Riders&pagenumber=2000&order=Rider&sending=asc&showLowRS=1&team=&kaldag=68&kalsaeson=45&nation=All&time=1533024969888
num_riders[c(deb_:fin_),1]=read_html(url) %>%
html_nodes("a") %>%
html_attr("onclick") %>%
as.matrix()
num_riders[c(deb_:fin_),2]=j
deb_=deb_+20
fin_=fin_+20
print(j)
}, error=function(e){})
}
riders1=as.data.frame(num_riders)
riders1$id_rider= sapply(strsplit(as.character(riders1[,1]), "\\'"), function(x) x[2])
riders1=riders1[,-1]
riders1$id_rider=as.numeric(riders1$id_rider)
names(riders1)=c("page","id_rider")
save(riders1,file = paste0("/Users/dflouriot/R/Cyclisme/Scrapping/Data/CronData/hire_listriders",date_jour,".RData"))
#Leur nom et age ?
#Rechercher tous les riders pas encore sortis
id_recent_rider=riders1 %>%
arrange(desc(id_rider)) %>%
filter(row_number()==1) %>%
select(id_rider) %>%
as.numeric()%>%
+1
id_recent_rider_max=id_recent_rider+300
caract_rider=matrix(nrow = 301, ncol = 2)
i=1
for (idr in id_recent_rider:id_recent_rider_max) {
#idr=id_recent_rider+82
url <- read_html(paste0("http://www.cyclingsimulator.com/ajax_riderprofile.php?riderid=",idr,""),encoding = "UTF-8")
#PAs de New version
#str(html_table(url, fill = TRUE)[1:100])
testt= url %>% html_nodes("body > table:nth-child(3)  ") %>%  html_text()
if (identical(testt,character(0))) {
}else {
caract_rider[i,1]=
url %>%
html_nodes("body > table:nth-child(3)  ")  %>%
html_text()
caract_rider[i,2]=idr
i=i+1
print(i)
}
}
caract_rider1=as.data.frame(caract_rider)
caract_rider1$id_rider=as.numeric(as.character(caract_rider1$V2))
caract_rider1$nom_prenom= gsub("Team","",sapply(strsplit(as.character(caract_rider1[,1]), ":"), function(x) x[2]))
caract_rider1$nationalite= gsub("Riding.*", "", gsub("Age","",sapply(strsplit(as.character(caract_rider1[,1]), ":"), function(x) x[3])))
caract_rider1$age=as.numeric(gsub(" yearsBirthday","",sapply(strsplit(as.character(caract_rider1[,1]), ":"), function(x) x[4])))
caract_rider1$jour_naissance= as.numeric(gsub("Team","",sapply(strsplit(sapply(strsplit(as.character(caract_rider1[,1]), ":"), function(x) x[5])," "), function(x) x[3])))
caract_rider1$team_spirit=as.numeric(gsub("Team","",sapply(strsplit(sapply(strsplit(as.character(caract_rider1[,1]), ":"), function(x) x[6]),"%"), function(x) x[1])))
caract_rider1$exp_level=as.numeric(substring(gsub(" ","",sapply(strsplit(sapply(strsplit(as.character(caract_rider1[,1]), ":"), function(x) x[7])," "), function(x) x[3])),1,1))
caract_rider1$ocm_tour_rank=as.numeric(sapply(strsplit(sapply(strsplit(as.character(caract_rider1[,1]), ":"), function(x) x[8])," "), function(x) x[2]))
caract_rider1$ocm_points=as.numeric(gsub("[^0-9]", "",sapply(strsplit(sapply(strsplit(as.character(caract_rider1[,1]), "OCM Tour Points:"), function(x) x[2])," "), function(x) x[2])))
caract_rider1$AV=as.numeric(gsub("Release","",sapply(strsplit(sapply(strsplit(as.character(caract_rider1[,1]), "Average Skill:"), function(x) x[2])," "), function(x) x[2])))
caract_rider1$value=as.numeric(gsub("\\.","",sapply(strsplit(sapply(strsplit(as.character(caract_rider1[,1]), "Release value:"), function(x) x[2])," "), function(x) x[2])))
caract_rider1=caract_rider1[,-c(1,2)]
caract_rider1$nom_prenom=gsub("^\\s+|\\s+$","",caract_rider1$nom_prenom)
caract_rider2=caract_rider1 %>%
filter(is.na(value)) %>%
filter(!is.na(id_rider))
save(caract_rider2,file = paste0("/Users/dflouriot/R/Cyclisme/Scrapping/Data/CronData/future_rid_hire_listriders",date_jour,".RData"))
lib="/home/dflouriot/Documents/R/Scrapping/Cyclisme/packrat/lib/x86_64-apple-darwin15.6.0/3.5.1/"
library(Rcrawler,lib.loc = lib)
packrat::on(project='/home/dflouriot/Documents/R/Scrapping/Cyclisme/')
packrat::status()
packrat::restore()
packrat::status()
packrat::restore()
packrat::snapshot()
packrat::status()
